{% extends 'layout/base.html' %}
{% block title %}
    Thông tin lớp học
{% endblock %}
{% block content %}
    <h1 style="text-align: center">Danh sách lớp {{ class_info.grade.value }}A{{ class_info.count }}</h1>
    <div class="d-flex justify-content-between p-5">
        <h2>GVCN: {{ class_info.teacher.user.profile.name }}</h2>
        <h2>Sĩ số: 40</h2>
    </div>
    <table id="myTable" class="table">
        <thead>
        <tr>
            <th scope="col">id</th>
            <th scope="col">name</th>
            <th scope="col">date</th>
            <th scope="col"></th>
        </tr>
        </thead>
        <tbody>
        {% for s in class_info.students %}
            <tr>
                <th scope="row">{{ s.student.profile.id }}</th>
                <td>{{ s.student.profile.name }}</td>
                <td>{{ s.student.profile.birthday.strftime("%d/%m/%Y") }}</td>
                <td>
                    <button class="btn btn-danger" onclick="deleteRow(this)">Xóa</button>
                </td>
            </tr>
        {% endfor %}

        <tr id="add-label">
            <th scope="row"><label for="student"></label></th>
            <td>
                <select class="form-select w-50" id="student" name="student">
                    {% for s in student_no_class %}
                        <option value="{{ s.id }}">{{ s.profile.name }}</option>
                    {% endfor %}
                </select>
            </td>
            <td></td>
            <td>
                <button class="btn btn-success" onclick="addRow()">Thêm</button>
            </td>
        </tr>
        </tbody>
    </table>
    <div class="d-flex justify-content-end">
        <button onclick="add()" id="add-btn" class="btn btn-primary">Lưu</button>
    </div>
    <script>
        add = []

        function deleteRow(button) {
            var result = confirm("Bạn có muốn xóa sinh viên này không?");
            if (result) {
                var row = button.parentNode.parentNode;
                // Remove the row
                row.parentNode.removeChild(row);
            }
        }

        function addRow() {
            var selectElement = document.getElementById("student");
            if (add.indexOf(selectElement.value) != -1) {
                confirm("Sinh viên đã có trong danh sách?");
                return
            }
            var table = document.getElementById("myTable");
            var lastRow = table.rows[table.rows.length - 1];
            var newRow = table.insertRow(lastRow.rowIndex)
            {% for s in student_no_class %}
                var id = {{ s.id }}
                console.log(selectElement.value)
                console.log(id)
                if (id == selectElement.value) {
                    newRow.insertCell(0).innerHTML = selectElement.value;
                    newRow.insertCell(1).innerHTML = "{{ s.profile.name }}";
                    newRow.insertCell(2).innerHTML = "{{ s.profile.birthday.strftime("%d/%m/%Y") }}";
                    newRow.insertCell(3).innerHTML = `<button class="btn btn-danger" onclick="deleteRow(this)">Xóa</button>`;
                    add.push(selectElement.value)

                }
            {% endfor %}

        }
    </script>
{% endblock %}